{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/yisus/Desktop/Nueva carpeta/OT304-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Validators } from '@angular/forms';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/app/core/services/http.service\";\nexport class NewsFormComponent {\n  constructor(fb, api) {\n    this.fb = fb;\n    this.api = api;\n    this.formData = new FormData();\n    this.name = '';\n    this.description = '';\n    this.create = true;\n    this.show = false;\n    this.analizeObject();\n    this.getCategories();\n  }\n\n  ngOnInit() {\n    this.formGroup = this.fb.group({\n      name: this.obj ? [this.obj.name, [Validators.required, Validators.minLength(4)]] : ['', [Validators.required, Validators.minLength(4)]],\n      content: this.obj ? [this.obj.content, Validators.required] : ['', [Validators.required]],\n      category: this.obj ? [this.obj.category, Validators.required] : ['', [Validators.required]],\n      image: ['', Validators.required]\n    });\n  }\n\n  get f() {\n    return this.formGroup.controls;\n  }\n\n  analizeObject() {\n    if (this.obj) {\n      this.create = false;\n    }\n  }\n\n  createOrEdit() {\n    var _a, _b, _c, _d, _e, _f;\n\n    if (this.create) {\n      this.api.post(environment.API_URL + 'news', false, {\n        name: (_a = this.formGroup.get('name')) === null || _a === void 0 ? void 0 : _a.value,\n        content: (_b = this.formGroup.get('content')) === null || _b === void 0 ? void 0 : _b.value,\n        image: this.imgBase64,\n        category_id: (_c = this.formGroup.get('category')) === null || _c === void 0 ? void 0 : _c.value\n      }).subscribe(res => {\n        console.log('post:', res);\n      });\n    } else {\n      this.api.put(environment.API_URL + 'news/' + this.obj.id, false, {\n        name: (_d = this.formGroup.get('name')) === null || _d === void 0 ? void 0 : _d.value,\n        content: (_e = this.formGroup.get('content')) === null || _e === void 0 ? void 0 : _e.value,\n        image: this.imgBase64,\n        category_id: (_f = this.formGroup.get('category')) === null || _f === void 0 ? void 0 : _f.value\n      }).subscribe(res => {\n        console.log('put: ', res);\n      });\n    }\n\n    this.show = !this.show;\n    setTimeout(() => {\n      this.show = !this.show;\n    }, 3000);\n    this.formGroup.reset();\n  }\n\n  fileOnChange(e) {\n    let imagen = e.target.files[0];\n    let allowedExtensions = /(.jpg|.png)$/i;\n\n    if (allowedExtensions.exec(imagen.name)) {\n      this.convertFileToBase64(imagen);\n    } else {\n      console.log(\"El archivo no es imagen\");\n      this.imgBase64 = null;\n      this.formGroup.controls.img.setErrors({\n        invalidExtension: true\n      });\n    }\n  }\n\n  convertFileToBase64(file) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onload = () => {\n        var _a;\n\n        _this.imgBase64 = (_a = reader.result) === null || _a === void 0 ? void 0 : _a.toString();\n      };\n    })();\n  }\n\n  getCategories() {\n    this.api.get(environment.API_URL + 'categories').subscribe(res => {\n      this.categorias = res.data;\n    });\n  }\n\n  changeCategory(event) {\n    var _a;\n\n    (_a = this.category) === null || _a === void 0 ? void 0 : _a.setValue(event.target.value);\n  }\n\n}\n\nNewsFormComponent.ɵfac = function NewsFormComponent_Factory(t) {\n  return new (t || NewsFormComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HttpService));\n};\n\nNewsFormComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: NewsFormComponent,\n  selectors: [[\"app-news-form\"]],\n  inputs: {\n    obj: \"obj\"\n  },\n  decls: 2,\n  vars: 0,\n  template: function NewsFormComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"p\");\n      i0.ɵɵtext(1, \"news-form works!\");\n      i0.ɵɵelementEnd();\n    }\n  },\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJuZXdzLWZvcm0uY29tcG9uZW50LnNjc3MifQ== */\"]\n});","map":{"version":3,"mappings":"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","names":["Validators","environment","NewsFormComponent","constructor","fb","api","FormData","analizeObject","getCategories","ngOnInit","formGroup","group","name","obj","required","minLength","content","category","image","f","controls","create","createOrEdit","post","API_URL","get","_a","value","_b","imgBase64","category_id","_c","subscribe","res","console","log","put","id","_d","_e","_f","show","setTimeout","reset","fileOnChange","e","imagen","target","files","allowedExtensions","exec","convertFileToBase64","img","setErrors","invalidExtension","file","reader","FileReader","readAsDataURL","onload","result","toString","categorias","data","changeCategory","event","setValue","i0","selectors","inputs","decls","vars","template"],"sourceRoot":"","sources":["C:\\Users\\yisus\\Desktop\\Nueva carpeta\\OT304-client\\src\\app\\features\\pages\\news\\news-form\\news-form.component.ts","C:\\Users\\yisus\\Desktop\\Nueva carpeta\\OT304-client\\src\\app\\features\\pages\\news\\news-form\\news-form.component.html"],"sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { HttpService } from 'src/app/core/services/http.service';\r\nimport { environment } from 'src/environments/environment';\r\n\r\n@Component({\r\n  selector: 'app-news-form',\r\n  templateUrl: './news-form.component.html',\r\n  styleUrls: ['./news-form.component.scss']\r\n})\r\nexport class NewsFormComponent implements OnInit {\r\n\r\n  //  @Input() obj : any = {\r\n  //   id:2413,\r\n  //   name: \"nombreTest\",\r\n  //   image: \"http://ongapi.alkemy.org/storage/08smgSTyLf.png\",\r\n  //   content: \"<p>descripcionTest</p>\",\r\n  //   category_id: 2292\r\n  // };\r\n\r\n  @Input() obj : any;\r\n\r\n  categorias : any;\r\n  \r\n  formData : FormData = new FormData();\r\n  formGroup !: FormGroup;\r\n  name : string = '';\r\n  description : string = '';\r\n  imgBase64 !: any;\r\n  categoryId !: any;\r\n  create : boolean = true;\r\n  category : any;\r\n  show : boolean = false;\r\n\r\n  constructor(private fb : FormBuilder, private api : HttpService) {\r\n\r\n    this.analizeObject();\r\n    this.getCategories();\r\n\r\n  }\r\n\r\n  ngOnInit(): void {\r\n\r\n\r\n    this.formGroup = this.fb.group({\r\n      name: this.obj ? [this.obj.name, [Validators.required, Validators.minLength(4)]] :['', [Validators.required, Validators.minLength(4)]],\r\n      content: this.obj ? [this.obj.content, Validators.required] :  ['', [Validators.required]],\r\n      category: this.obj ? [this.obj.category, Validators.required] :  ['', [Validators.required]],\r\n      image: ['', Validators.required],\r\n    });\r\n\r\n  }\r\n\r\n  get f(){\r\n    return this.formGroup.controls;\r\n  }\r\n\r\n  analizeObject(){\r\n    if(this.obj){\r\n\r\n      this.create = false;\r\n    }\r\n  }\r\n\r\n  createOrEdit(){\r\n\r\n    if(this.create){\r\n\r\n      this.api.post(environment.API_URL + 'news',false, {\r\n        name: this.formGroup.get('name')?.value,\r\n        content:this.formGroup.get('content')?.value,\r\n        image: this.imgBase64,\r\n        category_id: this.formGroup.get('category')?.value\r\n      })\r\n      .subscribe((res : any)=>{\r\n        console.log('post:', res);\r\n        \r\n      });\r\n  \r\n    }\r\n    else{\r\n\r\n      this.api.put( environment.API_URL+ 'news/' + this.obj.id,false, {\r\n        name: this.formGroup.get('name')?.value,\r\n        content:this.formGroup.get('content')?.value,\r\n        image: this.imgBase64,\r\n        category_id: this.formGroup.get('category')?.value\r\n      })\r\n      .subscribe((res : any )=>{\r\n        console.log('put: ', res)\r\n      });\r\n      \r\n    }\r\n\r\n    this.show = !this.show;\r\n    setTimeout(() => {\r\n\r\n    this.show = !this.show;\r\n\r\n    }, 3000);\r\n\r\n    this.formGroup.reset();\r\n   \r\n  }\r\n\r\n  fileOnChange(e: any) {\r\n\r\n    let imagen = e.target.files[0];\r\n    let allowedExtensions = /(.jpg|.png)$/i;\r\n\r\n    if (allowedExtensions.exec(imagen.name)) {\r\n      this.convertFileToBase64(imagen);\r\n    }\r\n    else {\r\n      console.log(\"El archivo no es imagen\");\r\n      this.imgBase64 = null;\r\n      this.formGroup.controls.img.setErrors({\r\n        invalidExtension: true\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  async convertFileToBase64(file: any) {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => {\r\n      this.imgBase64 = reader.result?.toString();\r\n    };\r\n  }\r\n\r\n  getCategories(){\r\n    this.api.get(environment.API_URL + 'categories')\r\n    .subscribe((res:any)=>{\r\n      this.categorias = res.data;\r\n    });\r\n  }\r\n\r\n  changeCategory(event : any){\r\n    this.category?.setValue(event.target.value);\r\n  }\r\n\r\n}\r\n","<p>news-form works!</p>\r\n"]},"metadata":{},"sourceType":"module"}